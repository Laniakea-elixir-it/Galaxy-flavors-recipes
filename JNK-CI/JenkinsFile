pipeline {
	agent { label 'jenkins_wn_1' }
	options { disableConcurrentBuilds() }
	stages {
		stage('write-to-db') {
			steps {
				withCredentials([sshUserPrivateKey(credentialsId: 'flavours_key', keyFileVariable: 'SSH_KEY')]) {
					sh ''' 
					  touch test_commit
						echo test > test_commit
						git add test_commit
						git commit -m "test commit"
						git push
						''' 
				}
			}
		}
	}
		post { 
			always { 
				cleanWs()
			}
			success {
				withCredentials([string(credentialsId: 'telegram_bot_API_token', variable: 'API_TOKEN')]) {
					//				build job: 'package_upload_to_cvmfs'
					sh 'curl -s -X POST https://api.telegram.org/bot$API_TOKEN/sendMessage -d chat_id=-667232678 -d text="Laniakea express package $FLAVOR:$VERSION for $IMAGE build: SUCCESS!!!"'
				}
			}
			failure {
				withCredentials([string(credentialsId: 'telegram_bot_API_token', variable: 'API_TOKEN')]) {
					sh 'curl -s -X POST https://api.telegram.org/bot$API_TOKEN/sendMessage -d chat_id=-667232678 -d text="Laniakea express package $FLAVOR:$VERSION for $IMAGE build: FAILED!!!"'
				}
			}
		}
	}

